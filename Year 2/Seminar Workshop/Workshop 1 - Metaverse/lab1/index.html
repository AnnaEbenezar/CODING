<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Canvas Monster game</title>
  </head>
  <body>
    <canvas style="border: 5px solid yellow" width="600" height="600"></canvas>
    <script>
      // Create the canvas
      var canvas = document.querySelector("canvas");
      var ctx = canvas.getContext("2d");

      // Background image
      var bgReady = false;
      var bgImage = new Image();
      bgImage.onload = function () {
        bgReady = true;
      };
      bgImage.src = "./images/background.png";

      // Hero image
      var heroReady = false;
      var heroImage = new Image();
      heroImage.onload = function () {
        heroReady = true;
      };
      heroImage.src = "./images/hero.png";

      // Game objects
      var hero = {
        x: 100,
        y: 100,
        speed: 256, // movement in pixels per second
      };

      var monster = {};
      var monstersCaught = 0;

      // Handle keyboard controls
      var keysDown = {};

      addEventListener(
        "keydown",
        function (e) {
          keysDown[e.keyCode] = true;
        },
        false
      );

      addEventListener(
        "keyup",
        function (e) {
          delete keysDown[e.keyCode];
        },
        false
      );

      // Reset the game when the player catches a monster
      var reset = function () {
        // Throw the monster somewhere on the screen randomly
        monster.x = Math.floor(Math.random() * 500);
        monster.y = Math.floor(Math.random() * 500);
      };

      // Update game objects
      var update = function (modifier) {
        // TODO: not allow player to move outside of the map 600*600
        let newposition = hero.speed * modifier;
        
        if (38 in keysDown) {
          // Player holding up
          hero.y -= hero.speed * modifier;
        }
        if (40 in keysDown) {
          // Player holding down
          hero.y += hero.speed * modifier;
        }
        if (37 in keysDown) {
          // Player holding left
          hero.x -= hero.speed * modifier;
        }
        if (39 in keysDown) {
          // Player holding right
          hero.x += hero.speed * modifier;
        }

        // Are they touching?
        // TODO: Add logic to check position collission

      };

      // Draw everything
      var render = function () {
        if (bgReady) {
          ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);
        }

        if (heroReady) {
          ctx.drawImage(heroImage, hero.x, hero.y);
        }

        // Score
        ctx.fillStyle = "rgb(250, 250, 250)";
        ctx.font = "24px Helvetica";
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.fillText("Monster caught: " + monstersCaught, 32, 32);
      };

      // The main game loop
      var main = function () {
        var now = Date.now();
        var delta = now - then;

        update(delta / 1000);
        render();

        then = now;
      };

      // Let's play this game!
      reset();
      var then = Date.now();
      setInterval(main, 100); // Execute as fast as possible
    </script>
  </body>
</html>
